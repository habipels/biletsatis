{% extends "homebase.html" %}
{% load static %}
{% load custom_filters %}
{% block sidebar %}

{% endblock sidebar %}
{% block content %}

<div class="ticket-details-page">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="left-image">
                        <img src="{{etkinlik.etkinlik_resim.url}}" alt="">
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="right-content">
                        <h4>{{etkinlik.etkinlik_adi}}</h4>
                        <span>Bilet Sayısı {{etkinlik.etkinlik_katitim_sayisi}}</span>
                        <ul>
                            <li><i class="fa fa-clock-o"></i> {{etkinlik.etkinlik_tarihi}}</li>
                            <li><i class="fa fa-map-marker"></i>{{etkinlik.etkinlik_yeri}}</li>
                            <li> <b>Organizatör : {{etkinlik.etkinlik_organizator}}</b> </li>
                        </ul>
                        <div class="quantity-content">
                            <div class="left-content">
                                <h6>Standard Bilet</h6>
                                <p>{{etkinlik.etkinlik_fiyati}} ₺ </p>
                            </div>
                            <div class="right-content">
                                <div class="quantity buttons_added">
                                    <input type="button" value="-" class="minus" onclick="updateQuantity(-1)">
                                    <input type="number" step="1" min="1" max="" name="quantity" value="1" title="Qty" class="input-text qty text" size="4" pattern="" inputmode="" id="quantity">
                                    <input type="button" value="+" class="plus" onclick="updateQuantity(1)">
                                </div>
                            </div>
                        </div>
                        <div class="total">
                            <h4>Toplam: <span id="toplam_fiyat">{{etkinlik.etkinlik_fiyati}} ₺</span></h4>
                            <div class="main-dark-button"><a href="#">SATIN AL</a></div>
                        </div>
                        <div class="warn">
                            <p></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<div class="seating-arrangement">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="table-responsive">
                    <table class="table table-bordered">
                    {% oturma_duzeni as deger %}
                    <tr>
                        {% for row in deger %}
                        {% if  row == "-1" %}
                            </tr>
                            <tr>
                        {% endif %}
                        {% if row != "-2" and row != "-1"  %}
                        <td class="seat" style="background-image: url('{% static 'assets/images/seat.png' %}'); background-size: cover;">
                            <input type="checkbox" class="seat-checkbox" value="{{ row }}" onclick="updateSeatSelection(this)">
                            {{ row }}
                        </td>
                        {% elif  row == "-2" %}
                        <td rowspan="2" colspan="3" style="text-align:center; background-image: url('https://www.berryalloc.com/-/media/sites/berryalloc/general/parquet/chateau-737x415px.ashx?h=415&w=737&la=tr-TR&hash=4F20AE50F2B9F7EBCE809E9B9139C9F7'); background-size: cover; background-position: center;" >
                            <b>SAHNE</b>
                        </td>
                        {% endif %}
                        {% endfor %}
                    </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="ticket-details-page">
        <div class="container">
            <div class="row">
              <div class="col-12">
                {{etkinlik.etkinlik_bilgilendirmesi |safe}}
              </div>
            </div>
        </div>
    </div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ticketPrice = parseFloat("{{etkinlik.etkinlik_fiyati}}");
        let selectedSeats = [];

        window.updateQuantity = function(change) {
            const quantityInput = document.getElementById('quantity');
            let quantity = parseInt(quantityInput.value);
            quantity = isNaN(quantity) ? 1 : quantity;
            quantity += change;
            if (quantity < 1) {
                quantity = 1;
            } else if (change < 0 && selectedSeats.length > 0) {
                const seatValue = selectedSeats.pop();
                document.querySelector(`.seat-checkbox[value="${seatValue}"]`).checked = false;
            }
            quantityInput.value = quantity;
            document.getElementById('toplam_fiyat').innerText = (ticketPrice * quantity).toFixed(2) + ' ₺';
        }

        window.updateSeatSelection = function(checkbox) {
            const seatValue = parseInt(checkbox.value);
            if (checkbox.checked) {
                selectedSeats.push(seatValue);
            } else {
                selectedSeats = selectedSeats.filter(seat => seat !== seatValue);
            }
            const quantityInput = document.getElementById('quantity');
            quantityInput.value = selectedSeats.length;
            document.getElementById('toplam_fiyat').innerText = (ticketPrice * selectedSeats.length).toFixed(2) + ' ₺';
        }
    });
</script>
{% endblock content %}